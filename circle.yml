dependencies:
  cache_directories:
    - "~/.stack"
    - ".stack-work"

  pre:
    - sudo apt-get update
    - sudo apt-get install rsync

  override:
    - (curl -sSL https://get.haskellstack.org/ | sh) || true
    - stack setup
    - stack build

test:
  override:
    - stack test

deployment:
  production:
    branch: master
    commands:
      - stack exec mk-com
      - rsync -avz -e "ssh -p 2555 -i $HOME/.ssh/id_circleci_github" _build/ admin@markkarpov.com:/home/admin/markkarpov.com
